data:application/octet-stream;base64,aW1wb3J0IGphdmEuaW8uRmlsZVJlYWRlcjsNCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOw0KaW1wb3J0IGphdmEudXRpbC5MaXN0Ow0KaW1wb3J0IGphdmEudXRpbC5NYXA7DQppbXBvcnQgb3JnLmpzb24uc2ltcGxlLkpTT05BcnJheTsNCmltcG9ydCBvcmcuanNvbi5zaW1wbGUuSlNPTk9iamVjdDsNCmltcG9ydCBvcmcuanNvbi5zaW1wbGUucGFyc2VyLkpTT05QYXJzZXI7DQoNCnB1YmxpYyBjbGFzcyBTZWNyZXRLZXlGaW5kZXIgew0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsNCiAgICAgICAgSlNPTlBhcnNlciBwYXJzZXIgPSBuZXcgSlNPTlBhcnNlcigpOw0KICAgICAgICANCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIEpTT05PYmplY3QganNvbk9iamVjdCA9IChKU09OT2JqZWN0KSBwYXJzZXIucGFyc2UobmV3IEZpbGVSZWFkZXIoInRlc3RjYXNlMV9uZXcuanNvbiIpKTsNCiAgICAgICAgICAgIEpTT05PYmplY3Qga2V5cyA9IChKU09OT2JqZWN0KSBqc29uT2JqZWN0LmdldCgia2V5cyIpOw0KICAgICAgICAgICAgaW50IG4gPSAoKExvbmcpIGtleXMuZ2V0KCJuIikpLmludFZhbHVlKCk7DQogICAgICAgICAgICBpbnQgayA9ICgoTG9uZykga2V5cy5nZXQoImsiKSkuaW50VmFsdWUoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgTGlzdDxQb2ludD4gZGVjcnlwdGVkUG9pbnRzID0gbmV3IEFycmF5TGlzdDw+KCk7DQogICAgICAgICAgICBmb3IgKE9iamVjdCBrZXkgOiBqc29uT2JqZWN0LmtleVNldCgpKSB7DQogICAgICAgICAgICAgICAgaWYgKCEia2V5cyIuZXF1YWxzKGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgaW50IHggPSBJbnRlZ2VyLnBhcnNlSW50KChTdHJpbmcpIGtleSk7DQogICAgICAgICAgICAgICAgICAgIEpTT05PYmplY3Qgb3BlcmF0aW9ucyA9IChKU09OT2JqZWN0KSBqc29uT2JqZWN0LmdldChrZXkpOw0KICAgICAgICAgICAgICAgICAgICBQb2ludCBwb2ludCA9IGRlY3J5cHRQb2ludCh4LCBvcGVyYXRpb25zKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvaW50ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlY3J5cHRlZFBvaW50cy5hZGQocG9pbnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBMaXN0PFBvaW50PiB2YWxpZFBvaW50cyA9IHZhbGlkYXRlUG9pbnRzKGRlY3J5cHRlZFBvaW50cyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICh2YWxpZFBvaW50cy5zaXplKCkgPj0gaykgew0KICAgICAgICAgICAgICAgIE1hcDxEb3VibGUsIExpc3Q8UG9pbnQ+PiBmcmVxdWVuY3lNYXAgPSBuZXcgSGFzaE1hcDw+KCk7DQogICAgICAgICAgICAgICAgZm9yIChQb2ludCBwb2ludCA6IHZhbGlkUG9pbnRzKSB7DQogICAgICAgICAgICAgICAgICAgIGRvdWJsZSBjb25zdGFudCA9IGxhZ3JhbmdlQ29uc3RhbnQodmFsaWRQb2ludHMsIHBvaW50LngpOw0KICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY3lNYXAucHV0SWZBYnNlbnQoY29uc3RhbnQsIG5ldyBBcnJheUxpc3Q8PigpKTsNCiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5TWFwLmdldChjb25zdGFudCkuYWRkKHBvaW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZG91YmxlIG1vc3RGcmVxdWVudEMgPSBmaW5kTW9zdEZyZXF1ZW50QyhmcmVxdWVuY3lNYXApOw0KICAgICAgICAgICAgICAgIExpc3Q8UG9pbnQ+IGNvcnJlc3BvbmRpbmdQb2ludHMgPSBmcmVxdWVuY3lNYXAuZ2V0KG1vc3RGcmVxdWVudEMpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiTW9zdCBGcmVxdWVudCBDb25zdGFudCBWYWx1ZSAoYyk6ICIgKyBtb3N0RnJlcXVlbnRDKTsNCiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkNvcnJlc3BvbmRpbmcgUG9pbnRzOiIpOw0KICAgICAgICAgICAgICAgIGZvciAoUG9pbnQgcCA6IGNvcnJlc3BvbmRpbmdQb2ludHMpIHsNCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCIoIiArIHAueCArICIsICIgKyBwLnkgKyAiKSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJOb3QgZW5vdWdoIHZhbGlkIHBvaW50cyB0byByZWNvbnN0cnVjdCB0aGUgc2VjcmV0IGtleS4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgcHVibGljIHN0YXRpYyBQb2ludCBkZWNyeXB0UG9pbnQoaW50IHgsIEpTT05PYmplY3Qgb3BlcmF0aW9ucykgew0KICAgICAgICBmb3IgKE9iamVjdCBvcCA6IG9wZXJhdGlvbnMua2V5U2V0KCkpIHsNCiAgICAgICAgICAgIFN0cmluZyBvcGVyYXRpb24gPSAoU3RyaW5nKSBvcDsNCiAgICAgICAgICAgIEpTT05BcnJheSB2YWx1ZXMgPSAoSlNPTkFycmF5KSBvcGVyYXRpb25zLmdldChvcCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGludCB5ID0gMDsNCiAgICAgICAgICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7DQogICAgICAgICAgICAgICAgY2FzZSAiTENNIjoNCiAgICAgICAgICAgICAgICAgICAgeSA9IGxjbSh2YWx1ZXMpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICJIQ0YiOg0KICAgICAgICAgICAgICAgICAgICB5ID0gaGNmKHZhbHVlcyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgIlNVTSI6DQogICAgICAgICAgICAgICAgICAgIHkgPSBzdW0odmFsdWVzKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAiTVVMIjoNCiAgICAgICAgICAgICAgICAgICAgeSA9IG11bHRpcGx5KHZhbHVlcyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgIkRJViI6DQogICAgICAgICAgICAgICAgICAgIHkgPSBkaXZpZGUodmFsdWVzKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAiU1VCIjoNCiAgICAgICAgICAgICAgICAgICAgeSA9IHN1YnRyYWN0KHZhbHVlcyk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOyAvLyBVbmtub3duIG9wZXJhdGlvbg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG5ldyBQb2ludCh4LCB5KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgDQogICAgcHVibGljIHN0YXRpYyBpbnQgbGNtKEpTT05BcnJheSB2YWx1ZXMpIHsNCiAgICAgICAgaW50IHJlc3VsdCA9IDE7DQogICAgICAgIGZvciAoT2JqZWN0IHZhbHVlIDogdmFsdWVzKSB7DQogICAgICAgICAgICByZXN1bHQgPSBsY20ocmVzdWx0LCAoKExvbmcpIHZhbHVlKS5pbnRWYWx1ZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgc3RhdGljIGludCBoY2YoSlNPTkFycmF5IHZhbHVlcykgew0KICAgICAgICBpbnQgcmVzdWx0ID0gKChMb25nKSB2YWx1ZXMuZ2V0KDApKS5pbnRWYWx1ZSgpOw0KICAgICAgICBmb3IgKE9iamVjdCB2YWx1ZSA6IHZhbHVlcykgew0KICAgICAgICAgICAgcmVzdWx0ID0gZ2NkKHJlc3VsdCwgKChMb25nKSB2YWx1ZSkuaW50VmFsdWUoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgDQogICAgcHVibGljIHN0YXRpYyBpbnQgc3VtKEpTT05BcnJheSB2YWx1ZXMpIHsNCiAgICAgICAgaW50IHJlc3VsdCA9IDA7DQogICAgICAgIGZvciAoT2JqZWN0IHZhbHVlIDogdmFsdWVzKSB7DQogICAgICAgICAgICByZXN1bHQgKz0gKChMb25nKSB2YWx1ZSkuaW50VmFsdWUoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgc3RhdGljIGludCBtdWx0aXBseShKU09OQXJyYXkgdmFsdWVzKSB7DQogICAgICAgIGludCByZXN1bHQgPSAxOw0KICAgICAgICBmb3IgKE9iamVjdCB2YWx1ZSA6IHZhbHVlcykgew0KICAgICAgICAgICAgcmVzdWx0ICo9ICgoTG9uZykgdmFsdWUpLmludFZhbHVlKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgDQogICAgcHVibGljIHN0YXRpYyBpbnQgZGl2aWRlKEpTT05BcnJheSB2YWx1ZXMpIHsNCiAgICAgICAgaW50IHJlc3VsdCA9ICgoTG9uZykgdmFsdWVzLmdldCgwKSkuaW50VmFsdWUoKTsNCiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPCB2YWx1ZXMuc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgICAgIHJlc3VsdCAvPSAoKExvbmcpIHZhbHVlcy5nZXQoaSkpLmludFZhbHVlKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgDQogICAgcHVibGljIHN0YXRpYyBpbnQgc3VidHJhY3QoSlNPTkFycmF5IHZhbHVlcykgew0KICAgICAgICBpbnQgcmVzdWx0ID0gKChMb25nKSB2YWx1ZXMuZ2V0KDApKS5pbnRWYWx1ZSgpOw0KICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8IHZhbHVlcy5zaXplKCk7IGkrKykgew0KICAgICAgICAgICAgcmVzdWx0IC09ICgoTG9uZykgdmFsdWVzLmdldChpKSkuaW50VmFsdWUoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgc3RhdGljIGludCBsY20oaW50IGEsIGludCBiKSB7DQogICAgICAgIHJldHVybiBhICogKGIgLyBnY2QoYSwgYikpOw0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgc3RhdGljIGludCBnY2QoaW50IGEsIGludCBiKSB7DQogICAgICAgIHdoaWxlIChiICE9IDApIHsNCiAgICAgICAgICAgIGludCB0ZW1wID0gYjsNCiAgICAgICAgICAgIGIgPSBhICUgYjsNCiAgICAgICAgICAgIGEgPSB0ZW1wOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhOw0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgc3RhdGljIExpc3Q8UG9pbnQ+IHZhbGlkYXRlUG9pbnRzKExpc3Q8UG9pbnQ+IHBvaW50cykgew0KICAgICAgICAvLyBJbXBsZW1lbnQgdmFsaWRhdGlvbiBsb2dpYyB0byBpZGVudGlmeSBhbmQgcmVtb3ZlIGluY29ycmVjdCBwb2ludHMNCiAgICAgICAgLy8gRm9yIHNpbXBsaWNpdHksIHRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyBhbGwgcG9pbnRzIGFyZSB2YWxpZA0KICAgICAgICByZXR1cm4gcG9pbnRzOw0KICAgIH0NCiAgICANCiAgICBwdWJsaWMgc3RhdGljIGRvdWJsZSBsYWdyYW5nZUNvbnN0YW50KExpc3Q8UG9pbnQ+IHBvaW50cywgaW50IHgpIHsNCiAgICAgICAgZG91YmxlIGNvbnN0YW50ID0gMDsNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwb2ludHMuc2l6ZSgpOyBpKyspIHsNCiAgICAgICAgICAgIGRvdWJsZSB0ZXJtID0gcG9pbnRzLmdldChpKS55Ow0KICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBwb2ludHMuc2l6ZSgpOyBqKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoaSAhPSBqKSB7DQogICAgICAgICAgICAgICAgICAgIHRlcm0gKj0gKGRvdWJsZSkgKHggLSBwb2ludHMuZ2V0KGopLngpIC8gKHBvaW50cy5nZXQoaSkueCAtIHBvaW50cy5nZXQoaikueCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3RhbnQgKz0gdGVybTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY29uc3RhbnQ7DQogICAgfQ0KICAgIA0KICAgIHB1YmxpYyBzdGF0aWMgZG91YmxlIGZpbmRNb3N0RnJlcXVlbnRDKE1hcDxEb3VibGUsIExpc3Q8UG9pbnQ+PiBmcmVxdWVuY3lNYXApIHsNCiAgICAgICAgZG91YmxlIG1vc3RGcmVxdWVudEMgPSAwOw0KICAgICAgICBpbnQgbWF4RnJlcXVlbmN5ID0gMDsNCiAgICAgICAgZm9yIChNYXAuRW50cnk8RG91YmxlLCBMaXN0PFBvaW50Pj4gZW50cnkgOiBmcmVxdWVuY3lNYXAuZW50cnlTZXQoKSkgew0KICAgICAgICAgICAgaWYgKGVudHJ5LmdldFZhbHVlKCkuc2l6ZSgpID4gbWF4RnJlcXVlbmN5KSB7DQogICAgICAgICAgICAgICAgbWF4RnJlcXVlbmN5ID0gZW50cnkuZ2V0VmFsdWUoKS5zaXplKCk7DQogICAgICAgICAgICAgICAgbW9zdEZyZXF1ZW50QyA9IGVudHJ5LmdldEtleSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBtb3N0RnJlcXVlbnRDOw0KICAgIH0NCn0NCg0KY2xhc3MgUG9pbnQgew0KICAgIGludCB4Ow0KICAgIGludCB5Ow0KICAgIA0KICAgIFBvaW50KGludCB4LCBpbnQgeSkgew0KICAgICAgICB0aGlzLnggPSB4Ow0KICAgICAgICB0aGlzLnkgPSB5Ow0KICAgIH0NCiAgICANCiAgICAvLyBHZXR0ZXJzIGFuZCBzZXR0ZXJzIGlmIG5lZWRlZA0KfQ0K